# üìä –ö–æ–º–ø–æ–Ω–µ–Ω—Ç: –ì—Ä–∞—Ñ–∏–∫ –∑–∞–¥–∞—á –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (Blazor Server + Bootstrap)

---

## üì¶ –§–∞–π–ª—ã:
- `TaskTimeline.razor` ‚Äî –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≥—Ä–∞—Ñ–∏–∫–∞
- `TaskCreator.razor` ‚Äî –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏ (—É–∂–µ –≥–æ—Ç–æ–≤)
- `TaskService.cs` ‚Äî —Å–µ—Ä–≤–∏—Å –¥–æ—Å—Ç—É–ø–∞ –∫ –∑–∞–¥–∞—á–∞–º
- `TaskItem`, `SubTaskItem` ‚Äî –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

---

## üé® –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –≥—Ä–∞—Ñ–∏–∫–∞: `TaskTimeline.razor`

```razor
@inject TaskService TaskService

<h3>–ì—Ä–∞—Ñ–∏–∫ –∑–∞–¥–∞—á</h3>

<button class="btn btn-success mb-3" @onclick="() => showCreateTask = !showCreateTask">
    @((showCreateTask ? "–°–∫—Ä—ã—Ç—å" : "–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É"))
</button>

@if (showCreateTask)
{
    <TaskCreator OnTaskCreated="ReloadTasks" />
}

<div class="timeline-container overflow-auto border p-2">
    <div class="timeline-grid">
        <!-- –®–∞–ø–∫–∞ —Å –¥–∞—Ç–∞–º–∏ -->
        <div class="timeline-header">
            @foreach (var day in DaysInMonth)
            {
                <div class="timeline-date text-center border-end">@day.ToString("dd")</div>
            }
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏ -->
        @foreach (var task in Tasks)
        {
            <div class="timeline-row">
                <div class="task-title border-end">
                    <span @onclick="@(() => ToggleExpand(task.Id))" style="cursor: pointer;">
                        <strong>@task.Title</strong>
                        <span class="ms-1 text-secondary">@(!expandedTasks.Contains(task.Id) ? "‚ñ∂" : "‚ñº")</span>
                    </span>
                </div>

                @foreach (var day in DaysInMonth)
                {
                    var isInRange = day >= task.StartDate.Date && day <= task.EndDate.Date;
                    <div class="timeline-cell" style="@((isInRange ? $"background-color: {task.Color};" : ""))">
                    </div>
                }
            </div>

            <!-- –ü–æ–¥–∑–∞–¥–∞—á–∏ -->
            @if (expandedTasks.Contains(task.Id))
            {
                foreach (var sub in task.SubTasks)
                {
                    <div class="timeline-row">
                        <div class="task-title border-end text-muted ps-4">
                            @sub.Title
                        </div>
                        @foreach (var day in DaysInMonth)
                        {
                            var isInRange = day >= sub.StartDate.Date && day <= sub.EndDate.Date;
                            <div class="timeline-cell" style="@((isInRange ? "background-color: #ccc;" : ""))"></div>
                        }
                    </div>
                }
            }
        }
    </div>
</div>

@code {
    private List<TaskItem> Tasks = new();
    private List<DateTime> DaysInMonth = new();
    private bool showCreateTask = false;
    private HashSet<int> expandedTasks = new();

    protected override async Task OnInitializedAsync()
    {
        await LoadData();
    }

    private async Task LoadData()
    {
        Tasks = await TaskService.GetTasksAsync();
        var start = new DateTime(DateTime.Today.Year, DateTime.Today.Month, 1);
        var end = start.AddMonths(1).AddDays(-1);
        DaysInMonth = Enumerable.Range(0, (end - start).Days + 1)
            .Select(offset => start.AddDays(offset)).ToList();
    }

    private void ToggleExpand(int taskId)
    {
        if (expandedTasks.Contains(taskId))
            expandedTasks.Remove(taskId);
        else
            expandedTasks.Add(taskId);
    }

    private async Task ReloadTasks()
    {
        await LoadData();
        StateHasChanged();
    }
}


.timeline-container {
    max-width: 100%;
}

.timeline-grid {
    display: grid;
    grid-template-columns: 200px repeat(auto-fill, 40px);
    grid-auto-rows: minmax(30px, auto);
    font-size: 0.9rem;
}

.timeline-header {
    display: contents;
}

.timeline-date {
    padding: 5px;
    font-weight: bold;
    background: #f8f9fa;
}

.timeline-row {
    display: contents;
}

.task-title {
    background: #fff;
    padding: 5px;
    font-weight: 500;
    white-space: nowrap;
}

.timeline-cell {
    border: 1px solid #dee2e6;
    height: 30px;
}


@code {
    [Parameter]
    public EventCallback OnTaskCreated { get; set; }

    private async Task HandleValidSubmit()
    {
        await TaskService.AddTaskAsync(newTask);
        await OnTaskCreated.InvokeAsync(); // –æ–±–Ω–æ–≤–∏—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—è
        ...
    }
}

.timeline-container {
    overflow-x: auto;
    border: 1px solid #dee2e6;
}

.timeline-grid {
    display: grid;
    grid-template-columns: 200px repeat(31, 40px); /* –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 31 –¥–µ–Ω—å, –º–æ–∂–Ω–æ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ –º–µ–Ω—è—Ç—å */
    grid-auto-rows: minmax(35px, auto);
    font-size: 0.9rem;
    min-width: max-content;
}

.timeline-header {
    display: contents;
}

.timeline-date {
    padding: 5px;
    font-weight: bold;
    background: #f8f9fa;
    text-align: center;
    border-right: 1px solid #dee2e6;
    border-bottom: 1px solid #dee2e6;
}

.timeline-row {
    display: contents;
}

.task-title {
    background: #fff;
    padding: 5px;
    font-weight: 500;
    white-space: nowrap;
    border-right: 1px solid #dee2e6;
    border-bottom: 1px solid #dee2e6;
}

.timeline-cell {
    border-right: 1px solid #dee2e6;
    border-bottom: 1px solid #dee2e6;
    height: 35px;
    position: relative;
    padding: 0;
}

.timeline-bar {
    height: 100%;
    width: 100%;
    color: #fff;
    font-weight: 500;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
    overflow: hidden;
    white-space: nowrap;
}

@foreach (var day in DaysInMonth)
{
    var isInRange = day >= task.StartDate.Date && day <= task.EndDate.Date;
    bool isStart = day == task.StartDate.Date;

    <div class="timeline-cell">
        @if (isInRange)
        {
            <div class="timeline-bar" style="background-color: @task.Color;">
                @if (isStart)
                {
                    @task.Title
                }
            </div>
        }
    </div>
}

@foreach (var day in DaysInMonth)
{
    var isInRange = day >= sub.StartDate.Date && day <= sub.EndDate.Date;
    bool isStart = day == sub.StartDate.Date;

    <div class="timeline-cell">
        @if (isInRange)
        {
            <div class="timeline-bar bg-secondary">
                @if (isStart)
                {
                    @sub.Title
                }
            </div>
        }
    </div>
}
